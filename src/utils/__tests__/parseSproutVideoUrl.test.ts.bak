/**
 * Tests for parseSproutVideoUrl utility
 * Feature: 004-embed-multiple-video
 *
 * IMPORTANT: These tests MUST FAIL initially (RED phase of TDD)
 * Implementation should only be written after tests are written and failing
 */

import { describe, it, expect } from 'vitest'
import { parseSproutVideoUrl } from '../parseSproutVideoUrl'

describe('parseSproutVideoUrl', () => {
  describe('T003: Public URL format', () => {
    it('should extract video ID from standard public URL', () => {
      const url = 'https://sproutvideo.com/videos/abc123xyz'
      const result = parseSproutVideoUrl(url)

      expect(result).toBe('abc123xyz')
    })

    it('should extract video ID from public URL with trailing slash', () => {
      const url = 'https://sproutvideo.com/videos/def456uvw/'
      const result = parseSproutVideoUrl(url)

      expect(result).toBe('def456uvw')
    })

    it('should handle uppercase and lowercase characters', () => {
      const url = 'https://sproutvideo.com/videos/AbC123XyZ'
      const result = parseSproutVideoUrl(url)

      expect(result).toBe('AbC123XyZ')
    })
  })

  describe('T004: Embed URL format', () => {
    it('should extract video ID from embed URL', () => {
      const url = 'https://videos.sproutvideo.com/embed/abc123xyz/token123'
      const result = parseSproutVideoUrl(url)

      expect(result).toBe('abc123xyz')
    })

    it('should extract video ID from embed URL without token', () => {
      const url = 'https://videos.sproutvideo.com/embed/def456uvw'
      const result = parseSproutVideoUrl(url)

      expect(result).toBe('def456uvw')
    })

    it('should handle embed URL with query parameters', () => {
      const url = 'https://videos.sproutvideo.com/embed/ghi789rst?autoplay=true'
      const result = parseSproutVideoUrl(url)

      expect(result).toBe('ghi789rst')
    })
  })

  describe('T005: Invalid URLs', () => {
    it('should return null for YouTube URL', () => {
      const url = 'https://youtube.com/watch?v=abc123'
      const result = parseSproutVideoUrl(url)

      expect(result).toBeNull()
    })

    it('should return null for non-URL string', () => {
      const url = 'not-a-url'
      const result = parseSproutVideoUrl(url)

      expect(result).toBeNull()
    })

    it('should return null for empty string', () => {
      const url = ''
      const result = parseSproutVideoUrl(url)

      expect(result).toBeNull()
    })

    it('should return null for Vimeo URL', () => {
      const url = 'https://vimeo.com/123456789'
      const result = parseSproutVideoUrl(url)

      expect(result).toBeNull()
    })
  })

  describe('T006: Malformed Sprout URLs', () => {
    it('should return null for Sprout domain without path', () => {
      const url = 'https://sproutvideo.com/'
      const result = parseSproutVideoUrl(url)

      expect(result).toBeNull()
    })

    it('should return null for videos path without ID', () => {
      const url = 'https://sproutvideo.com/videos/'
      const result = parseSproutVideoUrl(url)

      expect(result).toBeNull()
    })

    it('should return null for embed path without ID', () => {
      const url = 'https://videos.sproutvideo.com/embed/'
      const result = parseSproutVideoUrl(url)

      expect(result).toBeNull()
    })

    it('should handle whitespace-only string', () => {
      const url = '   '
      const result = parseSproutVideoUrl(url)

      expect(result).toBeNull()
    })
  })

  describe('Edge cases', () => {
    it('should trim whitespace before parsing', () => {
      const url = '  https://sproutvideo.com/videos/abc123xyz  '
      const result = parseSproutVideoUrl(url)

      expect(result).toBe('abc123xyz')
    })

    it('should handle HTTP (non-secure) URLs', () => {
      const url = 'http://sproutvideo.com/videos/abc123xyz'
      const result = parseSproutVideoUrl(url)

      expect(result).toBe('abc123xyz')
    })
  })
})
