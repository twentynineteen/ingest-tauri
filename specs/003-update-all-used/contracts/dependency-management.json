{
  "openapi": "3.0.0",
  "info": {
    "title": "Dependency Management API",
    "version": "1.0.0",
    "description": "Internal API for package dependency management operations"
  },
  "paths": {
    "/dependencies/scan": {
      "post": {
        "summary": "Scan project for current dependencies",
        "operationId": "scanDependencies",
        "responses": {
          "200": {
            "description": "Dependency scan completed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DependencyScanResult"
                }
              }
            }
          }
        }
      }
    },
    "/dependencies/audit": {
      "post": {
        "summary": "Run security audit on dependencies",
        "operationId": "auditDependencies",
        "responses": {
          "200": {
            "description": "Security audit completed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SecurityAuditResult"
                }
              }
            }
          }
        }
      }
    },
    "/dependencies/unused": {
      "post": {
        "summary": "Detect unused dependencies",
        "operationId": "detectUnusedDependencies",
        "responses": {
          "200": {
            "description": "Unused dependency detection completed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UnusedDependencyResult"
                }
              }
            }
          }
        }
      }
    },
    "/dependencies/update": {
      "post": {
        "summary": "Update dependencies to latest versions",
        "operationId": "updateDependencies",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Dependencies updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UpdateReport"
                }
              }
            }
          }
        }
      }
    },
    "/testing/migrate": {
      "post": {
        "summary": "Migrate from Jest to Vitest",
        "operationId": "migrateTestingFramework",
        "responses": {
          "200": {
            "description": "Testing framework migration completed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MigrationResult"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "PackageDependency": {
        "type": "object",
        "required": ["name", "currentVersion", "type", "isUsed"],
        "properties": {
          "name": {
            "type": "string",
            "pattern": "^[@a-z0-9][a-z0-9_\\-\\.]*[a-z0-9]$"
          },
          "currentVersion": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+\\.\\d+.*$"
          },
          "latestVersion": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+\\.\\d+.*$"
          },
          "type": {
            "type": "string",
            "enum": ["dependency", "devDependency", "peerDependency"]
          },
          "isUsed": {
            "type": "boolean"
          },
          "vulnerabilities": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SecurityVulnerability"
            }
          },
          "breakingChanges": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "packageManager": {
            "type": "string",
            "enum": ["npm", "bun"]
          }
        }
      },
      "SecurityVulnerability": {
        "type": "object",
        "required": ["id", "severity", "affectedVersions", "description", "source"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(CVE-\\d{4}-\\d{4,}|GHSA-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4})$"
          },
          "severity": {
            "type": "string",
            "enum": ["low", "moderate", "high", "critical"]
          },
          "affectedVersions": {
            "type": "string"
          },
          "patchedVersion": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+\\.\\d+.*$"
          },
          "description": {
            "type": "string"
          },
          "source": {
            "type": "string",
            "enum": ["npm", "github", "snyk", "nvd"]
          },
          "publishedDate": {
            "type": "string",
            "format": "date-time"
          },
          "fixAvailable": {
            "type": "boolean"
          }
        }
      },
      "DependencyScanResult": {
        "type": "object",
        "required": ["totalDependencies", "dependencies", "timestamp"],
        "properties": {
          "totalDependencies": {
            "type": "integer",
            "minimum": 0
          },
          "dependencies": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PackageDependency"
            }
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SecurityAuditResult": {
        "type": "object",
        "required": ["vulnerabilityCount", "vulnerabilities", "timestamp"],
        "properties": {
          "vulnerabilityCount": {
            "type": "object",
            "properties": {
              "low": { "type": "integer", "minimum": 0 },
              "moderate": { "type": "integer", "minimum": 0 },
              "high": { "type": "integer", "minimum": 0 },
              "critical": { "type": "integer", "minimum": 0 }
            }
          },
          "vulnerabilities": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SecurityVulnerability"
            }
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "UnusedDependencyResult": {
        "type": "object",
        "required": ["unusedPackages", "timestamp"],
        "properties": {
          "unusedPackages": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "UpdateRequest": {
        "type": "object",
        "properties": {
          "packagesToUpdate": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "updateType": {
            "type": "string",
            "enum": ["security", "minor", "major", "all"]
          },
          "allowBreakingChanges": {
            "type": "boolean",
            "default": false
          }
        }
      },
      "UpdateReport": {
        "type": "object",
        "required": ["timestamp", "packagesUpdated", "packagesRemoved", "testsStatus"],
        "properties": {
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "packagesUpdated": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PackageChange"
            }
          },
          "packagesRemoved": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "vulnerabilitiesFixed": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SecurityVulnerability"
            }
          },
          "breakingChanges": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BreakingChange"
            }
          },
          "testsStatus": {
            "type": "string",
            "enum": ["passing", "failing", "unknown"]
          },
          "buildStatus": {
            "type": "string",
            "enum": ["success", "failure", "unknown"]
          },
          "duration": {
            "type": "number",
            "minimum": 0
          }
        }
      },
      "PackageChange": {
        "type": "object",
        "required": ["packageName", "changeType", "reason"],
        "properties": {
          "packageName": {
            "type": "string"
          },
          "fromVersion": {
            "type": "string",
            "nullable": true
          },
          "toVersion": {
            "type": "string",
            "nullable": true
          },
          "changeType": {
            "type": "string",
            "enum": ["added", "updated", "removed", "patched"]
          },
          "reason": {
            "type": "string"
          },
          "hasBreakingChanges": {
            "type": "boolean"
          }
        }
      },
      "BreakingChange": {
        "type": "object",
        "required": ["packageName", "fromVersion", "toVersion", "changeDescription"],
        "properties": {
          "packageName": {
            "type": "string"
          },
          "fromVersion": {
            "type": "string"
          },
          "toVersion": {
            "type": "string"
          },
          "changeDescription": {
            "type": "string"
          },
          "affectedFiles": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "migrationSteps": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "resolutionStatus": {
            "type": "string",
            "enum": ["pending", "in_progress", "resolved"]
          }
        }
      },
      "MigrationResult": {
        "type": "object",
        "required": ["migratedFiles", "configurationUpdated", "testsStatus"],
        "properties": {
          "migratedFiles": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "configurationUpdated": {
            "type": "boolean"
          },
          "testsStatus": {
            "type": "string",
            "enum": ["passing", "failing", "unknown"]
          },
          "removedPackages": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    }
  }
}